Detected kernel version 3.10.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
Opening file: 01.txt
Opening file: 02.txt
Opening file: 03.txt
Opening file: 04.txt

[INFO] Using device: cuda
Loading checkpoint shards:   0%|          | 0/17 [00:00<?, ?it/s]Loading checkpoint shards:   6%|▌         | 1/17 [00:17<04:47, 17.94s/it]Loading checkpoint shards:  12%|█▏        | 2/17 [00:33<04:11, 16.77s/it]Loading checkpoint shards:  18%|█▊        | 3/17 [00:36<02:24, 10.31s/it]Loading checkpoint shards:  24%|██▎       | 4/17 [00:50<02:34, 11.87s/it]Loading checkpoint shards:  29%|██▉       | 5/17 [01:10<02:57, 14.82s/it]Loading checkpoint shards:  35%|███▌      | 6/17 [01:24<02:40, 14.56s/it]Loading checkpoint shards:  41%|████      | 7/17 [01:42<02:35, 15.60s/it]Loading checkpoint shards:  47%|████▋     | 8/17 [02:01<02:29, 16.56s/it]Loading checkpoint shards:  53%|█████▎    | 9/17 [02:13<02:02, 15.30s/it]Loading checkpoint shards:  59%|█████▉    | 10/17 [02:34<01:59, 17.02s/it]Loading checkpoint shards:  65%|██████▍   | 11/17 [02:51<01:41, 16.96s/it]Loading checkpoint shards:  71%|███████   | 12/17 [03:08<01:25, 17.06s/it]Loading checkpoint shards:  76%|███████▋  | 13/17 [03:54<01:43, 25.79s/it]Loading checkpoint shards:  82%|████████▏ | 14/17 [04:26<01:23, 27.67s/it]Loading checkpoint shards:  88%|████████▊ | 15/17 [04:41<00:47, 23.94s/it]Loading checkpoint shards:  94%|█████████▍| 16/17 [05:00<00:22, 22.32s/it]Loading checkpoint shards: 100%|██████████| 17/17 [05:17<00:00, 20.68s/it]Loading checkpoint shards: 100%|██████████| 17/17 [05:17<00:00, 18.67s/it]
You shouldn't move a model that is dispatched using accelerate hooks.
Traceback (most recent call last):
  File "/mnt/parscratch/users/liq23wr/dissertation/main.py", line 37, in <module>
    response = chat(model_id, query)
               ^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/parscratch/users/liq23wr/dissertation/models.py", line 29, in chat
    token=hf_token).to(device)
                    ^^^^^^^^^^
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/accelerate/big_modeling.py", line 459, in wrapper
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/transformers/modeling_utils.py", line 3110, in to
    return super().to(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1343, in to
    return self._apply(convert)
           ^^^^^^^^^^^^^^^^^^^^
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 903, in _apply
    module._apply(fn)
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 903, in _apply
    module._apply(fn)
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 903, in _apply
    module._apply(fn)
  [Previous line repeated 2 more times]
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 930, in _apply
    param_applied = fn(param)
                    ^^^^^^^^^
  File "/users/liq23wr/.conda/envs/dis-venv/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1329, in convert
    return t.to(
           ^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 128.00 MiB. GPU 0 has a total capacity of 79.14 GiB of which 111.50 MiB is free. Including non-PyTorch memory, this process has 79.02 GiB memory in use. Of the allocated memory 78.61 GiB is allocated by PyTorch, and 512.00 KiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
